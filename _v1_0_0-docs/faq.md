---
title: FAQ
layout: default
prev_section: troubleshooting
next_section: known-issues
category: Miscellaneous
permalink: v1_0_0-docs/faq/
---

## Issue: Intermittent memory leaks in all components when `checkThreadLocalMapForLeaks`.

I am running our backup process every night and it appears to be ok, but I am still seeing evidences of intermittent memory leaks in all the components when `checkThreadLocalMapForLeaks`.

The typical message in the log is:

<pre><code>
Jan 19, 2015 3:01:39 AM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks
SEVERE: The web application [/extractor-web] created a ThreadLocal with key of type [com.codahale.metrics.ThreadLocalRandom$1] (value [com.codahale.metrics.ThreadLocalRandom$1@6475dc22]) and a value of type [com.codahale.metrics.ThreadLocalRandom] (value [com.codahale.metrics.ThreadLocalRandom@68008a89]) but failed to remove it when the web application was stopped.
</code></pre>

Threads are going to be renewed over time to try to avoid a probable memory leak.

The key types are different based on the component:

ces-coordinator

* com.ontotext.ces.utils.sparql.SparqlRestTemplateClient$1
* org.openrdf.query.resultio.sparqlxml.SPARQLResultsXMLParser

ces-worker

* com.sun.xml.bind.v2.ClassFactory$1
* java.util.WeakHashMap
* com.codahale.metrics.ThreadLocalRandom$1

graphdb

* com.ontotext.trree.plugin.lucene4.IndexHandler.ThreadLocalQueryParser
com.ontotext.trree.plugin.lucene4.KeepURIsMultiFieldQueryParser

solr

* com.datastax.driver.core.TypeCodec$StringCodec$1
* org.apache.solr.schema.DateField.ThreadLocalDateFormat

recommendation

* com.codahale.metrics.ThreadLocalRandom$1

Additionally, when running `clearReferencesJdbc`, GraphDB logs the following :

The web application `/graphdb-workbench-se` registered the JDBC driver `org.h2.Driver` but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.
The web application `/graphdb-workbench-se` appears to have started a thread named `UnusedConnectionsCollector` but has failed to stop it. This is very likely to create a memory leak.

## Answer:

This is very likely to create a memory leak, in the following case:
[Deploying on a running Tomcat server](http://tomcat.apache.org/tomcat-7.0-doc/deployer-howto.html#Deploying_on_a_running_Tomcat_server).
Basically, it means that re-deploying the same application (`graphdb-workbench-se/ces-worker/coordinator`) on a running Tomcat server, it is likely that memory leaks are created. As long as you restart the Tomcat server for backing up/redeployment there will be no memory leaks.
More info on the matter can be found [here](http://wiki.apache.org/tomcat/MemoryLeakProtection).
Some of these are generated by code which is not directly under our control, i.e. the metrics library, the datastax driver, so there is no easy way for us to fix this. We can, however, guarantee that you will have no issues if you stick to restarting Tomcat each time a `war` file is being re-deployed and that these messages can safely be ignored on Tomcat shutdown.
