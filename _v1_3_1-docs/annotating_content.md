---
layout: default
title: Annotate Content
prev_section: ces_components
next_section: dynamic_gazetteer
category: HowTo's
permalink: v1_3_1-docs/annotating_content/
---

## Introduction

This section describes how to annotate documents with CES (Concept Extraction Service).

*Annotating* a document is the process of adding a set of metadata about words or phrases to an unstructured text.

A *mention* is a piece of text with attached metadata features, which is usually (but not necessarily) associated with a *concept*. Mentions always have:

* `type` - the type of the annotation, usually Person, Organization, or Location, but other types can be returned as well;
* `startOffset`, `endOffset` - 0-based offsets in the original text;
* `features map` - contains any number of properties/features depending on the origin of the mention;
* concept - a resource (URI) that represents a real life entity, used for recognizing mentions in texts.

For example, annotating the text "Hello London" will yield a mention such as the one below. It has a `startOffset` and `endOffset`, and is associated with the concept `http://dbpedia.org/resource/London`.

<pre><code>

{
  "name": "London",
  "startOffset": 9,
  "endOffset": 15,
  "type": "Location",
  "features map": {
      "inst": "http://dbpedia.org/resource/London",
      "class": "http://www.ontotext.com/proton/protontop#Location",
      "string": "London",
      "id": 392
    }
}
</code></pre>

## Notation

All URLs in this document are of the form `http://worker-base/endpoint`, where `http://worker-base` is the `host:port/context` of a deployed CES worker and `endpoint` is the specific worker call. For example, if the worker is deployed at `http://192.168.0.1/extractor-web` and this guide mentions `http://worker-base/extract`, then the URL for querying will be `http://192.168.0.1/extractor-web/extract`.

## Annotation request

Annotation requests go to `http://worker-base/extract`. There are two ways to invoke an annotation:

* `GET` request with a `url` parameter (e.g. `http://worker-base/extract?url=http://www.bbc.com/culture/story/20141020-the-plane-that-changed-air-travel`);
* `POST` request with a meaningful `Content-type` header and a body of the specified type. The content type of the input document, whether specified by a URL or a request header, should be in one of the supported input formats.

<div class="note-badge">
It is also advisable to specify <code>Accept</code> header with the desired output mime type. Usually the default is <code>application/vnd.ontotext.ces+json</code>. For more details, see Supported output formats.
</div>

### Setting timeout

You can also specify a timeout in ms. This is especially useful in at least three cases:

* when you want to avoid particularly large documents clogging the system
* when you want to avoid a document triggering a bug to eat the CPU
* when you want to ensure you either get results within a specific time frame or fail fast

Extending the previous `GET` example, you can say you want the actual annotation process to take no longer than 2 seconds like this: `http://worker-base/extract?url=http://www.bbc.com/culture/story/20141020-the-plane-that-changed-air-travel&timeout=2000`

<div class="info-badge">
When we showed the <a href="http://tag.ontotext.com/">Tagging Service</a> to our Sales team for the first time, in 2 minutes they were already trying to annotate a 200 page document. Since it didn't return results immediately, they tried again a few times, until the service was completely clogged. May the right timeout be with you!
</div>

## Supported input formats

* the standard web text formats such as text/xml, text/html and text/plain;
* Ontotext's generic document schema in either JSON (`application/vnd.ontotext.ces.document+json`) or XML (`application/vnd.ontotext.ces.document+xml`) format;
* formats supported by <a href="http://tika.apache.org/1.5/formats.html">Apache Tika</a>.

## Supported output formats

<div class="note-badge">
If <code>Accept</code> header is not specified, the simple mentions JSON format is returned (<code>application/vnd.ontotext.ces+json</code>).
</div>

* Ontotext's generic document schema in either JSON (`application/vnd.ontotext.ces.document+json`) or XML (`application/vnd.ontotext.ces.document+xml`) format;
* the "simple mentions" JSON format (`application/vnd.ontotext.ces` or `application/vnd.ontotext.ces+json`), as described in more details below.

## Typical mention features

Mention features can vary a lot, depending on the sub-system that generates the mention. However, most mentions have:

* `inst` - the concept URI of a mention. It either points to a concept database (freebase, dbpedia, etc.) or is generated by machine learning sub-systems;
* `class` - generally related to the `type` of the mention; the `class` is the class name URI in the concept database;
* `string` - а piece of text associated with this mention (its label); the text between the  `startOffset` and `endOffset`;
* `id` - the numeric ID of the mention, which is unique for the document;
* `isTrusted` – a Boolean feature denoting whether the concept instance is present in the knowledge base;
* `confidence` - the statistic probability output of the machine learning classifiers;
* `relevance` - term frequency, weighted with offset from document beginning;

Mentions can have other features that are database and type dependent. For example, locations can also have a `featClass`, `featCode`, `countryCode`, etc., which provide more information about the concept.

## Examples

### Posting plain text

Request:

<pre><code>

POST /extractor-web/extract
Content-length: 14
Content-type: text/plain
Accept: application/vnd.ontotext.ces+json

Hello London!
</code></pre>

Response:

<pre><code>

{
  "mentions": [{
      "name": "London",
      "startOffset": 6,
      "endOffset": 12,
      "type": "Location",
      "features": {
          "inst": "http://dbpedia.org/resource/London",
          "class": "http://www.ontotext.com/proton/protontop#Location",
          "string": "London",
          "id": 392
      }
    }]
}
</code></pre>

### Posting and receiving generic document

Request:

<pre><code>

POST /extractor-web/extract
Content-type: application/vnd.ontotext.ces.document+xml
Accept: application/vnd.ontotext.ces.document+json

<?xml version="1.0" encoding="utf-8"?>
<tns:document xmlns:tns="http://www.ontotext.com/DocumentSchema" xmlns="http://www.w3.org/1999/xhtml" id="222-222">
    <tns:document-parts>
      <tns:document-part id="1" part="BODY">
        <tns:content>Hello, London!</tns:content>
      </tns:document-part>
    </tns:document-parts>
</tns:document>

</code></pre>


Response:

<pre><code>

{
  "id": "222-222",
  "feature-set": [],
  "document-parts": {
      "feature-set": [{
        "name": {
            "type": "XS_STRING",
            "name": "encoding"
          },
          "value": {
            "type": "XS_STRING",
            "lang": null,
            "value": "UTF-8"
          }
      }],
        "document-part": [{
          "id": "1",
          "part": "BODY",
          "content": {
            "text": "Hello, London!",
            "node": [{
                "id": "0",
                "offset": 0
            }, {
                "id": "7",
                "offset": 7
            }, {
                "id": "13",
                "offset": 13
            }, {
                "id": "14",
                "offset": 14
            }]
        },
          "feature-set": []
    }]
  },
  "annotation-sets": [{
      "name": "",
      "ref": null,
      "annotation": []
  }, {
      "name": "Final",
      "ref": null,
      "annotation": [{
      "id": "51",
      "startnode": "7",
      "endnode": "13",
      "type": "Location",
      "status": "Suggested",
      "generated": false,
      "feature-set": [{
          "name": {
              "type": "XS_STRING",
              "name": "inst"
          },
          "value": {
              "type": "XS_STRING",
              "lang": null,
              "value": "http://dbpedia.org/resource/London"
          }
    }, {
        "name": {
            "type": "XS_STRING",
            "name": "class"
         },
        "value": {
            "type": "XS_STRING",
            "lang": null,
            "value": "http://www.ontotext.com/proton/protontop#Location"
        }
     }, {
         "name": {
            "type": "XS_STRING",
            "name": "string"
        },
        "value": {
            "type": "XS_STRING",
            "lang": null,
            "value": "London"
        }
     }, {
         "name": {  
            "type": "XS_STRING",
            "name": "id"
         },
         "value": {
            "type": "XS_INTEGER",
            "lang": null,
            "value": "392"
          }
        }]
      }]
  }]
}
</code></pre>

## Simple mentions format

### JSON

<pre><code>
{
  "mentions": [{
  "name": "London", // the name of the mention, usually the string between startOffset and endOffset
  "startOffset": 6, // start offset of the mention
  "endOffset": 12, // end offset of the mention
  "type": "Location", // the mention type
  "features": {
                "inst": "http://dbpedia.org/resource/London", // the instance id (URI) of the concept associated with this mention
                "class": "http://www.ontotext.com/proton/protontop#Location", // the class of the mentioned concept within the knowledge base
                "string": "London", // the sting between startOffset and endOffset
                "id": 392 // a unique id within the document
                // ... other features
              }
  }, {
      // ... more annotations
              }]
}
</code></pre>
